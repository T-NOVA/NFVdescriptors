# YAML VNFD transscripted from ETSI VNFD - T-NOVA VNFD and OpenMANO examples
# Version: 2.0.2
# Date: 24/09/2015 
# Copyright: T-NOVA Consortium
# Info: Template for single VNFC VNF 
# Changelog: Initial version

vnf:
  release: "T-NOVA v0.2b" # Release information
  id: 624 # NFStore provides the rules, not know prior to uploading and cannot be referenced on time zero
  provider: "NCSRD" # Provider(T-NOVA) - Vendor (ETSI)
  provider_id: 23 # FP given by ID by the Marketplace
  name: "Traffic Classification"
  description: "The function identifies, classifies and forwards network traffic according to policies"
  descriptor_version: "0.1"
  version: "0.22"
  manifest_file_md5: "fa8773350c4c236268f0bd7807c8a3b2" # Calculated by the NFStore during upload
  type: "TC"
  created_at: '2015-12-18T21:15:47Z' # Auto inserted at the Marketplace
  modified_at: '2015-12-18T21:15:47Z' # Auto inserted at the Marketplace (to bechecked)
  trade: true
  billing_model:
    model: "PAYG" # Valid Options are PAYG and Revenue Sharing (RS)
    period: "P1W" # Per 1 week, e.g. P1D per 1 day
    price:
      unit: "EUR"
      min_per_period: 5
      max_per_period: 10
      setup: 0

  # VNF lifecycle events redirect to the appropriate VDU lifecycle events below and reference the vdu ids.
  vnf_lifecycle_events:
    start:
      - vdu_id: "vdu0"
        vdu_event: "start"
    stop:
      - vdu_id: "vdu0"
        vdu_event: "stop"
    restart: []
    scale-in: []
    scale-out: []

  # VDU is the section where the VM properties should be referenced. This template should contain one VDU = 1 VM = 1VNFC and is providing a single flavour
  vdu:
    - id: "vdu0" # VDUs numbered in sequence (TBD)
      alias: "tc_core_vm"
      vm_image: "http://store.t-nova.eu/NCSRDv/TC_ncsrd.v.022.qcow" # URL that contains the
      vm_image_md5: "a5e4533d63f71395bdc7debd0724f433" # generated by the NFStore
      vm_image_format: "qcow2" # NFStore should store this (Allowed values: ami, ari, aki, vhd, vmdk, raw, qcow2, vdi, iso)

      # VDU instantiation resources
      resource_requirements:
        vcpus: 2
        cpu_support_accelerator: "AES-NI" # Opt. if accelarators are required

        memory: 2 # default: GB
        memory_unit: "GB" # MB/GB (optional)

        memory_parameters: # Optional
          large_pages_required: ""
          numa_allocation_policy: ""

        storage:
          size: 20 # default: GB
          size_unit: "GB" # MB/GB/TB (optional)
          persistence: false # Storage persistence true/false

        hypervisor_parameters:
          type: "QEMU-KVM"
          version: "10002|12001|2.6.32-358.el6.x86_64"

        platform_pcie_parameters: # Opt. required if SR-IOV is used for graphics accelaration
          device_pass_through: true
          SR-IOV: true

        network_interface_card_capabilities:
          mirroring: false
          SR-IOV: true

        network_interface_bandwidth: "10Gbps"
        data_processing_acceleration_library: "eg DPDK v1.0"

        vswitch_capabilities:
          type: "ovs"
          version: "2.0"
          overlay_tunnel: "GRE"

      networking_resources:
		  average: "7Mbps"
		  peak: "10Mbps"
		  burst: "100KBytes"

      #VDU Lifecycle enents
      vdu_lifecycle_events:
        driver:
          authentication_type: "PubKeyAuthentication"
          driver: "ssh"
        events:
          start:
            command: "service xxx start"
            template_file: '{"controller":"cntr_IP", "vdu1":"vdu1_IP", "vdu2":"vdu2_IP"}'
            template_file_format: "JSON"
          stop:
            command: service xxx stop
            template_file: '{"controller":"cntr_IP","vdu1":"vdu1_IP","vdu2":"vdu2_IP"}'
            template_file_format: "JSON"
          restart:
            command: ''
            template_file: ''
            template_file_format: ''
          scale-in: ''
          scale-out: ''

      # VDU Scaling config
      scale_in_out: # number of instances for scaling allowed
        minimum: 1 # min number of instances
        maximum: 5 # max number of instances, if max=min then no scaling is allowed

      # VNFC specific networking config
      vnfc:
        id: "vdu0:vnfc0" #incremental reference of VNFCs in the VDU

        networking:
          # Start of T-NOVA networking section
          - connection_point_id: "mngt0" # for monitoring and management purposes
            vitual_link_reference: "mngt"
            type: "floating" # The type of interface i.e floating_ip, vnic, tap "TO COMPLETE"
            bandwidth: "100Mbps"
          - connection_point_id: "data0" # datapath interface
            vitual_link_reference: "data"
            type: "vnic" # The type of interface i.e floating_ip, vnic, tap "TO COMPLETE"
            bandwidth: "100Mbps"
          - connection_point_id: "data1"
            vitual_link_reference: "data"
            type: "vnic" # The type of interface i.e floating_ip, vnic, tap "TO COMPLETE"
            bandwidth: "100Mbps"
          - connection_point_id: "store0"
            vitual_link_reference: "TO COMPLETE"
            type: "" # The type of interface i.e floating_ip, vnic, tap "TO COMPLETE"
            bandwidth: "100Mbps

      vlink:
        # T-NOVA VL Section : relative to resources:networks HEAT template, subnets and dns information should be filled from the Orchestrator therefore are not put here.
        - vl_id: "mngt"
          connectivity_type: "E-Line"
          connection_points_reference: ["vdu0:mngt0", "vnf0:mngt0"]
          root_requirement: "10Gbps"
          leaf_requirement: "10Gbps" # Used only for E-tree
          qos: "" # optional
          test_access: "active" # Active: Use ext IP to be reached, Passive: L2 access via steering, None: no access
          net_segment: "192.168.1.0/24" #a-priori allocation by the system during approval of the VNFD.
          dhcp: "TRUE"
        - vl_id: "data"
          connectivity_type: "E-LAN"
          connection_points_reference: ["vdu0:data0", "vdu0:data1", "vnf0:data0"]
          root_requirement: "10Gbps"
          leaf_requirement: "10Gbps" # Used only for E-tree
          qos: "" # optional
          test_access: "passive"
          net_segment: "192.168.1.0/24" #a-priori allocation by the system during approval of the VNFD.
          dhcp: "TRUE"
        - vl_id: "store"
          connectivity_type: "E-Line"
          connection_points_reference: ["vdu0:store0"]
          root_requirement: "10Gbps"
          leaf_requirement: "10Gbps" # Used only for E-tree
          qos: "" # optional
          test_access: "none" # optional
          net_segment: "192.168.1.0/24" #a-priori allocation by the system during approval of the VNFD.
          dhcp: "TRUE"

      monitoring_parameters:
        generic:
        - desc: Availability
          metric: availability
          unit: '%'
        - desc: CPU Usage
          metric: cpu_usage
          unit: '%'
        - desc: Memory Usage
          metric: memory_usage
          unit: '%'
        - desc: Memory Used
          metric: memory_used
          unit: MB
        - desc: Free Memory
          metric: memory_free
          unit: MB
        - desc: Disk IO
          metric: disk_io
          unit: MB/sec
        - desc: Available Disk Space
          metric: disk_free
          unit: GB
        - desc: Incoming Bandwidth
          metric: bps_in
          unit: Mbps
        - desc: Outgoing Bandwidth
          metric: bps_out
          unit: Mbps
        specific:
        - desc: Packets Dropped
          metric: packets_dropped
          unit: packets

      auto_scale_policy:
        - policy_name: "policy1"
          type: "number_of_flows"
          threshold: "100K"
          action_type: "TO BE COMPLETED e.g flavour ID"

  # VNF Flavour section + SLS
  deployment_flavours:
    - flavour_id: "vnfd0:flavour0"
      flavour_key: "flows_fw_100K" # this flavour will support 100K
      constraint: "specific HW constrain" #TBD
      constituent_vdu:
        vdu_reference: "vdu0"
        number_of_instances: 1
        constituent_vnfc: "vdu0:vnfc0"

      assurance_parameters:
        - param_id: "memory-consumption"
          value: 1
          unit: "GB"
          formula: "memory-consumption LT 1"
          violation:
            - breaches_count: 2
              interval: 30
            - breaches_count: 5
              interval: 120
          penalty:
            type: "discount"
            value: 5
            unit: "percentage"
            validity: "P1D"
        - param_id: "CPU-utilization"
          value: 85
          unit: "percentage"
          formula: "CPU-utilization LT 0.85"
          violation:
            - breaches_count: 2
              interval: 30
          penalty:
            type: "discount"
            value: 5
            unit: "percentage"
            validity: "P1D"